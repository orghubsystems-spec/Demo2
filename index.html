<!DOCTYPE html>
<html lang="pl">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: Collage, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #fff;
      text-align: center;
    }
    .hidden { display: none; }
    .container { margin-top: 40px; }

    .login-box input, .login-box select {
      display: block;
      margin: 10px auto;
      padding: 8px;
      width: 200px;
      border-radius: 6px;
      border: none;
    }

    button {
      padding: 8px 16px;
      border: none;
      background: red;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button[disabled] {
      background: gray !important;
      cursor: default;
    }

    .full-btn {
      display: block;
      width: 200px;
      margin: 10px auto;
      padding: 8px;
      border-radius: 6px;
      background: red;
      border: none;
      color: white;
      cursor: pointer;
    }
    .full-btn.alt { background: #333; }

    .card {
      border: 1px solid #555;
      border-radius: 10px;
      padding: 10px;
      margin: 10px;
      background: #111;
    }

    .lista-zapisanych {
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      padding: 8px;
      margin-top: 6px;
      text-align: left;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    #wersjaApki {
      position: fixed;
      top: 8px;
      right: 12px;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.6);
      user-select: none;
      z-index: 1000;
    }

    button.loading {
      background: #222 !important;
      opacity: 0.6;
      pointer-events: none;
      transition: background 0.2s ease, opacity 0.2s ease;
    }

    /* Splash */
    #splash {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #000;
    }
    .logo-fadein {
      width: 300px;
      opacity: 0;
      filter: brightness(20%) blur(2px);
      transform: scale(0.2);
      animation: wjazdLogo 5s ease-out forwards;
    }
    @keyframes wjazdLogo {
      0%   { opacity: 0;   transform: scale(0.2); filter: brightness(20%) blur(4px); }
      60%  { opacity: 1;   transform: scale(1.1); filter: brightness(160%) blur(0); }
      85%  { opacity: 1;   transform: scale(1);   filter: brightness(100%); }
      100% { opacity: 0;   transform: scale(1);   filter: brightness(50%) blur(2px); }
    }

    .select-like-input {
      width: 200px;
      height: 36px;
      margin: 10px auto;
      border-radius: 6px;
      border: none;
      padding: 6px;
      font-size: 14px;
      display: block;
    }

    .grupa-check {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 14px;
      color: white;
    }
    .grupa-check input {
      margin-bottom: 4px;
      transform: scale(1.3);
    }

    .btn {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: #444;
      color: #fff;
      cursor: pointer;
      margin: 2px;
    }
    .btn.danger {
      background: #800;
    }

    #trainerDeletePopup {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 2000;
      display: none;
    }

    #trainerDeletePopup.show {
      display: flex;
    }

    #trainerDeletePopup .popup-card {
      background: #111;
      border: 1px solid #555;
      border-radius: 10px;
      padding: 16px 20px;
      max-width: 260px;
      text-align: center;
    }
    
    /* ===== BUSY OVERLAY ===== */
    #busyOverlay.hidden {
      display: none !important;
    }
    
    button input { font-size: 14px;
    }

    
  </style>

  <script>
    const WERSJA_APKI = '1.07.02';
    const poprzednia = localStorage.getItem('wersjaApki');
    if (poprzednia !== WERSJA_APKI) {
      localStorage.setItem('wersjaApki', WERSJA_APKI);
      location.reload(true);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(r => console.log("‚úÖ SW zarejestrowany:", r))
        .catch(e => console.error("‚ùå B≈ÇƒÖd SW:", e));
    }
  </script>
</head>

<body>
  <div id="wersjaApki"><span id="wersjaNum"></span></div>
  
<div id="busyOverlay" class="hidden" style="
  position:fixed; inset:0; background:rgba(0,0,0,0.85);
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  z-index:5000; padding:24px;
">
  <div style="font-size:20px; margin-bottom:12px;">‚è≥ Przygotowujƒô aplikacjƒô‚Ä¶</div>
  <div id="busyOverlayMsg" style="opacity:.85; max-width:320px; line-height:1.4;">
    Tworzƒô pliki klubu, ustawiam sezon i konfiguracjƒô.
  </div>
</div>

  
  <!-- Splash -->
  <div id="splash">
    <img src="icon-512.png" class="logo-fadein" alt="Logo">
  </div>

  <!-- G≈Ç√≥wna aplikacja -->
  <div id="app" class="hidden">

   <!-- LANDING ORGHUB -->
<div id="orgHubLandingView" class="container hidden">
  <h1 style="margin-bottom:8px;">ORGHUB SYSTEMS</h1>
  <p style="opacity:0.8;margin-top:0;">Panel startowy</p>
  <button class="full-btn" onclick="goToConfig()">Skonfiguruj klub</button>
</div>

<!-- KONFIGURACJA KLUBU -->
<div id="clubConfigView" class="container hidden">
  <h1>Konfiguracja klubu</h1>

  <div class="card" style="max-width:320px;margin:12px auto;">
    <!-- LOGO -->
    <button class="full-btn" onclick="pickLogo()">Wgraj swoje logo</button>
    <div style="margin-top:8px;">
      <img id="cfgLogoPreview" src="" alt="" style="display:none;width:160px;border-radius:10px;border:1px solid #444;">
      <div style="font-size:12px;opacity:0.75;margin-top:6px;">
        PNG/JPG, najlepiej kwadrat, np. 512√ó512
      </div>
      <input id="cfgLogoInput" type="file" accept="image/*" class="hidden" />
    </div>

    <!-- NAZWA -->
    <button class="full-btn alt" id="btnClubName" onclick="clubNameEditStart()">
    <span id="clubNameText">Podaj nazwƒô klubu</span>
    <input id="clubNameInput" type="text" class="hidden"
         placeholder="Wpisz nazwƒô klubu"
         style="width:100%;box-sizing:border-box;padding:8px;border-radius:6px;border:none;">
    </button>

    <div id="cfgClubNameLabel" style="margin-top:6px;opacity:0.9;"></div>

    <!-- SEZON START -->
    <button class="full-btn alt" onclick="editSeasonStart()">PoczƒÖtek sezonu</button>
    <div id="cfgSeasonStartLabel" style="margin-top:6px;opacity:0.9;"></div>

    <!-- SEZON END -->
    <button class="full-btn alt" onclick="editSeasonEnd()">Koniec sezonu</button>
    <div id="cfgSeasonEndLabel" style="margin-top:6px;opacity:0.9;"></div>

    <!-- KOLOR T≈ÅA -->
    <button class="full-btn alt" onclick="toggleColorPicker(true)">Wybierz kolor t≈Ça</button>
    <div id="cfgColorLabel" style="margin-top:6px;opacity:0.9;"></div>

    <div id="cfgColorGrid" class="hidden" 
          style="margin-top:10px;display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;">
      <!-- kolory wype≈Çnimy z JS -->
    </div>

    <!-- EMAIL -->
    <button class="full-btn alt" onclick="editEmail()">Tw√≥j email</button>
    <div id="cfgEmailLabel" style="margin-top:6px;opacity:0.9;"></div>

    <button class="full-btn" style="margin-top:14px;" onclick="submitClubConfig()">Wy≈õlij</button>
    <button class="full-btn alt" onclick="goBackFromConfig()">‚¨Ö Powr√≥t</button>

    <p id="cfgMsg" style="margin-top:10px;"></p>
  </div>
</div>

<!-- START / ORGHUB -->
<div id="orgHubStartView" class="container hidden">
  <div style="margin-top:30px;">
    <img src="icon-512.png" style="width:220px;border-radius:24px;opacity:.95;">
  </div>

  <h1 style="margin-top:18px;">ORGHUB SYSTEMS</h1>
  <div style="opacity:.75;margin:10px auto 20px;max-width:320px;line-height:1.4;">
    Kreator utworzy pliki Twojego klubu i przygotuje aplikacjƒô do dzia≈Çania.
  </div>

  <button class="full-btn" onclick="goToView('clubWizardView')">‚öôÔ∏è Skonfiguruj klub</button>

  <div style="opacity:.55;margin-top:18px;font-size:13px;">
    Masz ju≈º klub na tym urzƒÖdzeniu? <br>
    <button class="btn" onclick="pokazClubSetup(true)">Zmie≈Ñ / wybierz clubId</button>
  </div>
</div>

    <!-- KREATOR KLUBU -->
<div id="clubWizardView" class="container hidden">
  <h1>Konfiguracja klubu</h1>

  <div class="card" style="max-width:320px;margin:12px auto; text-align:left;">
    <div style="opacity:.8;font-size:13px;margin-bottom:8px;">
      Uzupe≈Çnij dane. Klikasz przycisk ‚Üí pojawia siƒô okno do wpisania / wyboru.
    </div>

    <button class="full-btn" onclick="wizPickLogo()">üì∑ Wgraj swoje logo</button>
    <div id="wizLogoInfo" style="opacity:.75;font-size:12px;margin:6px 0 10px;">
      JPG/PNG, najlepiej kwadrat, min. 512√ó512.
    </div>
    <div id="wizLogoPreview" style="margin-bottom:10px;"></div>
    <input id="wizLogoFile" type="file" accept="image/*" class="hidden">

    <button class="full-btn" onclick="wizPromptText('wizClubName','Podaj nazwƒô klubu')">üè∑Ô∏è Podaj nazwƒô klubu</button>
    <div id="wizClubNameLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizPromptMonthYear('wizSeasonStart','PoczƒÖtek sezonu (MM-RRRR)')">üìÖ PoczƒÖtek sezonu</button>
    <div id="wizSeasonStartLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizPromptMonthYear('wizSeasonEnd','Koniec sezonu (MM-RRRR)')">üèÅ Koniec sezonu</button>
    <div id="wizSeasonEndLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizPickColor()">üé® Wybierz kolor t≈Ça</button>
    <div id="wizColorLabel" style="opacity:.85;margin:6px 0 12px;display:flex;align-items:center;gap:10px;">
      <span id="wizColorSwatch" style="width:18px;height:18px;border-radius:6px;border:1px solid #555;display:inline-block;"></span>
      <span id="wizColorText">‚Äî</span>
    </div>

    <button class="full-btn" onclick="wizPromptText('wizEmail','Tw√≥j email')">üì© Tw√≥j email</button>
    <div id="wizEmailLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizSubmit()">üöÄ Wy≈õlij</button>
    <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>

    <div id="wizMsg" style="margin-top:10px;opacity:.9;"></div>
  </div>
</div>

    
    <!-- LOGOWANIE -->
    <div id="loginView" class="container hidden">
      <img src="https://i.imgur.com/tTBcBSj.jpeg" class="logo" style="width:200px;margin-bottom:20px;">
      <h1>Logowanie</h1>
      <div style="opacity:.8; margin-bottom:10px;">
        Club: <b id="clubIdBadge"></b>
      </div>
      <div class="login-box">
        <input id="numer" type="text" placeholder="Numer / Inicja≈Çy">
        <input id="haslo" type="password" placeholder="Has≈Ço">
        <button class="full-btn" onclick="zaloguj()">Zaloguj</button>
        <button class="full-btn alt" onclick="pokazRejestracjaSelect()">Rejestracja</button>
        <button class="full-btn alt" onclick="pokazClubSetup(true)">‚öô Zmie≈Ñ klub</button>
      </div>
      <p id="komunikat"></p>
    </div>

    <!-- WYB√ìR TYP REJESTRACJI -->
    <div id="registerSelectView" class="container hidden">
      <h1>Rejestracja</h1>
      <button class="full-btn" onclick="pokazRejestracjaZawodnik()">Zawodnik</button>
      <button class="full-btn" onclick="pokazRejestracjaTrener()">Trener</button>
      <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- REJESTRACJA ZAWODNIKA -->
    <div id="registerZawodnikView" class="container hidden">
      <h1>Rejestracja zawodnika</h1>
      <div class="login-box">
        <input id="regNumer" type="number" placeholder="Numer zawodnika">
        <input id="regNazwisko" type="text" placeholder="Imiƒô i nazwisko">
        <input id="regHaslo" type="password" placeholder="Ustaw has≈Ço">
        <button class="full-btn" onclick="wyslijRejestracje()">Zarejestruj</button>
      </div>
      <p id="regMsg"></p>
      <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- REJESTRACJA TRENERA -->
    <div id="rejestracjaTrenerView" class="container hidden">
      <h1>Rejestracja trenera</h1>
      <div class="login-box">
        <input id="regNazwiskoTrener" type="text" placeholder="Imiƒô i nazwisko">
        <input id="regHasloTrener" type="password" placeholder="Ustaw has≈Ço">
        <button class="full-btn" onclick="wyslijRejestracjeTrener()">Zarejestruj</button>
        <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>
      </div>
      <p id="regMsgTrener"></p>
    </div>

    <!-- DODAJ WYDARZENIE (TRENER) -->
    <div id="trainerDodajWydarzenieView" class="container hidden">
      <h1>Dodaj wydarzenie</h1>

      <div class="login-box">
        <input id="eventData" type="date">
        <input id="eventStart" type="time">
        <input id="eventEnd" type="time">
        <input id="eventRodzaj" type="text" placeholder="Rodzaj wydarzenia">

        <select id="eventTrener1" class="select-like-input">
          <option value="">‚Äî wybierz trenera ‚Äî</option>
        </select>

        <select id="eventTrener2" class="select-like-input">
          <option value="">‚Äî brak ‚Äî</option>
        </select>
      </div>

      <!-- CHECKBOXY GRUP -->
      <div style="display:flex; justify-content:center; gap:25px; margin:20px auto 10px auto; width:260px;">
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G1"><span>G1</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G2"><span>G2</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G3"><span>G3</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G4"><span>G4</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G5"><span>G5</span></label>
      </div>

      <div style="margin-top:10px;">
        <label>
          <input id="eventStat" type="checkbox">
          Liczyƒá do statystyk
        </label>
      </div>

      <button class="full-btn" onclick="wyslijNoweWydarzenie()">üíæ Dodaj wydarzenie</button>
      <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>

      <p id="eventMsg" style="margin-top:10px;"></p>
    </div>

    <!-- P≈ÅATNO≈öCI -->
    <div id="platnosciView" class="container hidden">
      <h1>P≈Çatno≈õci</h1>
      <div id="listaPlatnosci">≈Åadowanie...</div>
    </div>

    <!-- WYDARZENIA (ZAWODNIK) -->
    <div id="homeView" class="container hidden">
      <h1 id="tytulTreningow">TWOJE WYDARZENIA</h1>
      <div id="listaTreningow">≈Åadowanie...</div>
      <button onclick="pokazStatystyki()" style="margin-top:20px;">üìà Poka≈º statystyki</button>
      <button onclick="powrotDoPlatnosci()" style="margin-top:10px;background:#333;">‚¨Ö Powr√≥t do p≈Çatno≈õci</button>
    </div>

    <!-- STATYSTYKI -->
    <div id="statsView" class="container hidden">
      <h1>Moje statystyki</h1>
      <div id="listaStatystyk">≈Åadowanie...</div>
      <button onclick="powrotDoTreningow()" style="margin-top:20px;">‚¨Ö Powr√≥t</button>
    </div>

    <!-- PANEL TRENERA -->
    <div id="trainerPanelView" class="container hidden">
      <h1>Panel trenera</h1>
      <button class="full-btn" onclick="trainerPokazZawodnicy()">üë• Zawodnicy</button>
      <button class="full-btn" onclick="trainerPokazWydarzenia()">üèí Wydarzenia</button>
      <button class="full-btn alt" onclick="pokazLogowanie()">‚¨Ö Wyloguj</button>
    </div>

    <!-- LISTA ZAWODNIK√ìW (TRENER) -->
    <div id="trainerZawodnicyView" class="container hidden">
      <h1>Lista zawodnik√≥w</h1>
      <div id="trainerListaZawodnikow">≈Åadowanie...</div>
      <button class="full-btn alt" onclick="trainerPowrot()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- WYDARZENIA (TRENER) -->
    <div id="trainerWydarzeniaView" class="container hidden">
      <h1>Wydarzenia</h1>
      <div id="trainerListaWydarzen">≈Åadowanie...</div>
      <button class="full-btn" style="margin-top:20px;" onclick="pokazDodajWydarzenie()">‚ûï Dodaj wydarzenie</button>
      <button class="full-btn alt" onclick="trainerPowrot()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- Popup potwierdzenia usuniƒôcia -->
    <div id="trainerDeletePopup">
      <div class="popup-card">
        <p style="margin-bottom:15px;">Czy napewno chcesz usunƒÖƒá wydarzenie ?</p>
        <button class="full-btn" onclick="trainerConfirmDeleteYes()">TAK</button>
        <button class="full-btn alt" style="margin-top:8px;" onclick="trainerHideDeletePopup()">Anuluj</button>
      </div>
    </div>
  </div><!-- /app -->

  <!-- BUSY OVERLAY -->
<div id="busyOverlay" class="hidden" style="
  position:fixed; inset:0; background:rgba(0,0,0,0.75);
  display:flex; align-items:center; justify-content:center;
  z-index:5000;">
  <div class="card" style="max-width:280px;text-align:center;">
    <div style="font-size:18px;margin-bottom:8px;">‚è≥ Przygotowujƒô aplikacjƒô‚Ä¶</div>
    <div id="busyText" style="opacity:0.85;font-size:13px;">Tworzƒô pliki i ustawienia klubu.</div>
  </div>
</div>

  <script>
  <!DOCTYPE html>
<html lang="pl">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: Collage, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #fff;
      text-align: center;
    }
    .hidden { display: none; }
    .container { margin-top: 40px; }

    .login-box input, .login-box select {
      display: block;
      margin: 10px auto;
      padding: 8px;
      width: 200px;
      border-radius: 6px;
      border: none;
    }

    button {
      padding: 8px 16px;
      border: none;
      background: red;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button[disabled] {
      background: gray !important;
      cursor: default;
    }

    .full-btn {
      display: block;
      width: 200px;
      margin: 10px auto;
      padding: 8px;
      border-radius: 6px;
      background: red;
      border: none;
      color: white;
      cursor: pointer;
    }
    .full-btn.alt { background: #333; }

    .card {
      border: 1px solid #555;
      border-radius: 10px;
      padding: 10px;
      margin: 10px;
      background: #111;
    }

    .lista-zapisanych {
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      padding: 8px;
      margin-top: 6px;
      text-align: left;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    #wersjaApki {
      position: fixed;
      top: 8px;
      right: 12px;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.6);
      user-select: none;
      z-index: 1000;
    }

    button.loading {
      background: #222 !important;
      opacity: 0.6;
      pointer-events: none;
      transition: background 0.2s ease, opacity 0.2s ease;
    }

    /* Splash */
    #splash {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #000;
    }
    .logo-fadein {
      width: 300px;
      opacity: 0;
      filter: brightness(20%) blur(2px);
      transform: scale(0.2);
      animation: wjazdLogo 5s ease-out forwards;
    }
    @keyframes wjazdLogo {
      0%   { opacity: 0;   transform: scale(0.2); filter: brightness(20%) blur(4px); }
      60%  { opacity: 1;   transform: scale(1.1); filter: brightness(160%) blur(0); }
      85%  { opacity: 1;   transform: scale(1);   filter: brightness(100%); }
      100% { opacity: 0;   transform: scale(1);   filter: brightness(50%) blur(2px); }
    }

    .select-like-input {
      width: 200px;
      height: 36px;
      margin: 10px auto;
      border-radius: 6px;
      border: none;
      padding: 6px;
      font-size: 14px;
      display: block;
    }

    .grupa-check {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 14px;
      color: white;
    }
    .grupa-check input {
      margin-bottom: 4px;
      transform: scale(1.3);
    }

    .btn {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: #444;
      color: #fff;
      cursor: pointer;
      margin: 2px;
    }
    .btn.danger {
      background: #800;
    }

    #trainerDeletePopup {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 2000;
      display: none;
    }

    #trainerDeletePopup.show {
      display: flex;
    }

    #trainerDeletePopup .popup-card {
      background: #111;
      border: 1px solid #555;
      border-radius: 10px;
      padding: 16px 20px;
      max-width: 260px;
      text-align: center;
    }
    
    /* ===== BUSY OVERLAY ===== */
    #busyOverlay.hidden {
      display: none !important;
    }
    
    button input { font-size: 14px;
    }

    
  </style>

  <script>
    const WERSJA_APKI = '1.08.02';
    const poprzednia = localStorage.getItem('wersjaApki');
    if (poprzednia !== WERSJA_APKI) {
      localStorage.setItem('wersjaApki', WERSJA_APKI);
      location.reload(true);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(r => console.log("‚úÖ SW zarejestrowany:", r))
        .catch(e => console.error("‚ùå B≈ÇƒÖd SW:", e));
    }
  </script>
</head>

<body>
  <div id="wersjaApki"><span id="wersjaNum"></span></div>
  
<div id="busyOverlay" class="hidden" style="
  position:fixed; inset:0; background:rgba(0,0,0,0.85);
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  z-index:5000; padding:24px;
">
  <div style="font-size:20px; margin-bottom:12px;">‚è≥ Przygotowujƒô aplikacjƒô‚Ä¶</div>
  <div id="busyOverlayMsg" style="opacity:.85; max-width:320px; line-height:1.4;">
    Tworzƒô pliki klubu, ustawiam sezon i konfiguracjƒô.
  </div>
</div>

  
  <!-- Splash -->
  <div id="splash">
    <img src="icon-512.png" class="logo-fadein" alt="Logo">
  </div>

  <!-- G≈Ç√≥wna aplikacja -->
  <div id="app" class="hidden">

   <!-- LANDING ORGHUB -->
<div id="orgHubLandingView" class="container hidden">
  <h1 style="margin-bottom:8px;">ORGHUB SYSTEMS</h1>
  <p style="opacity:0.8;margin-top:0;">Panel startowy</p>
  <button class="full-btn" onclick="goToConfig()">Skonfiguruj klub</button>
</div>

<!-- KONFIGURACJA KLUBU -->
<div id="clubConfigView" class="container hidden">
  <h1>Konfiguracja klubu</h1>

  <div class="card" style="max-width:320px;margin:12px auto;">
    <!-- LOGO -->
    <button class="full-btn" onclick="pickLogo()">Wgraj swoje logo</button>
    <div style="margin-top:8px;">
      <img id="cfgLogoPreview" src="" alt="" style="display:none;width:160px;border-radius:10px;border:1px solid #444;">
      <div style="font-size:12px;opacity:0.75;margin-top:6px;">
        PNG/JPG, najlepiej kwadrat, np. 512√ó512
      </div>
      <input id="cfgLogoInput" type="file" accept="image/*" class="hidden" />
    </div>

    <!-- NAZWA -->
    <button class="full-btn alt" id="btnClubName" onclick="clubNameEditStart()">
    <span id="clubNameText">Podaj nazwƒô klubu</span>
    <input id="clubNameInput" type="text" class="hidden"
         placeholder="Wpisz nazwƒô klubu"
         style="width:100%;box-sizing:border-box;padding:8px;border-radius:6px;border:none;">
    </button>

    <div id="cfgClubNameLabel" style="margin-top:6px;opacity:0.9;"></div>

    <!-- SEZON START -->
    <button class="full-btn alt" onclick="editSeasonStart()">PoczƒÖtek sezonu</button>
    <div id="cfgSeasonStartLabel" style="margin-top:6px;opacity:0.9;"></div>

    <!-- SEZON END -->
    <button class="full-btn alt" onclick="editSeasonEnd()">Koniec sezonu</button>
    <div id="cfgSeasonEndLabel" style="margin-top:6px;opacity:0.9;"></div>

    <!-- KOLOR T≈ÅA -->
    <button class="full-btn alt" onclick="toggleColorPicker(true)">Wybierz kolor t≈Ça</button>
    <div id="cfgColorLabel" style="margin-top:6px;opacity:0.9;"></div>

    <div id="cfgColorGrid" class="hidden" 
          style="margin-top:10px;display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;">
      <!-- kolory wype≈Çnimy z JS -->
    </div>

    <!-- EMAIL -->
    <button class="full-btn alt" onclick="editEmail()">Tw√≥j email</button>
    <div id="cfgEmailLabel" style="margin-top:6px;opacity:0.9;"></div>

    <button class="full-btn" style="margin-top:14px;" onclick="submitClubConfig()">Wy≈õlij</button>
    <button class="full-btn alt" onclick="goBackFromConfig()">‚¨Ö Powr√≥t</button>

    <p id="cfgMsg" style="margin-top:10px;"></p>
  </div>
</div>

<!-- START / ORGHUB -->
<div id="orgHubStartView" class="container hidden">
  <div style="margin-top:30px;">
    <img src="icon-512.png" style="width:220px;border-radius:24px;opacity:.95;">
  </div>

  <h1 style="margin-top:18px;">ORGHUB SYSTEMS</h1>
  <div style="opacity:.75;margin:10px auto 20px;max-width:320px;line-height:1.4;">
    Kreator utworzy pliki Twojego klubu i przygotuje aplikacjƒô do dzia≈Çania.
  </div>

  <button class="full-btn" onclick="goToView('clubWizardView')">‚öôÔ∏è Skonfiguruj klub</button>

  <div style="opacity:.55;margin-top:18px;font-size:13px;">
    Masz ju≈º klub na tym urzƒÖdzeniu? <br>
    <button class="btn" onclick="pokazClubSetup(true)">Zmie≈Ñ / wybierz clubId</button>
  </div>
</div>

    <!-- KREATOR KLUBU -->
<div id="clubWizardView" class="container hidden">
  <h1>Konfiguracja klubu</h1>

  <div class="card" style="max-width:320px;margin:12px auto; text-align:left;">
    <div style="opacity:.8;font-size:13px;margin-bottom:8px;">
      Uzupe≈Çnij dane. Klikasz przycisk ‚Üí pojawia siƒô okno do wpisania / wyboru.
    </div>

    <button class="full-btn" onclick="wizPickLogo()">üì∑ Wgraj swoje logo</button>
    <div id="wizLogoInfo" style="opacity:.75;font-size:12px;margin:6px 0 10px;">
      JPG/PNG, najlepiej kwadrat, min. 512√ó512.
    </div>
    <div id="wizLogoPreview" style="margin-bottom:10px;"></div>
    <input id="wizLogoFile" type="file" accept="image/*" class="hidden">

    <button class="full-btn" onclick="wizPromptText('wizClubName','Podaj nazwƒô klubu')">üè∑Ô∏è Podaj nazwƒô klubu</button>
    <div id="wizClubNameLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizPromptMonthYear('wizSeasonStart','PoczƒÖtek sezonu (MM-RRRR)')">üìÖ PoczƒÖtek sezonu</button>
    <div id="wizSeasonStartLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizPromptMonthYear('wizSeasonEnd','Koniec sezonu (MM-RRRR)')">üèÅ Koniec sezonu</button>
    <div id="wizSeasonEndLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizPickColor()">üé® Wybierz kolor t≈Ça</button>
    <div id="wizColorLabel" style="opacity:.85;margin:6px 0 12px;display:flex;align-items:center;gap:10px;">
      <span id="wizColorSwatch" style="width:18px;height:18px;border-radius:6px;border:1px solid #555;display:inline-block;"></span>
      <span id="wizColorText">‚Äî</span>
    </div>

    <button class="full-btn" onclick="wizPromptText('wizEmail','Tw√≥j email')">üì© Tw√≥j email</button>
    <div id="wizEmailLabel" style="opacity:.85;margin:6px 0 12px;">‚Äî</div>

    <button class="full-btn" onclick="wizSubmit()">üöÄ Wy≈õlij</button>
    <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>

    <div id="wizMsg" style="margin-top:10px;opacity:.9;"></div>
  </div>
</div>

    
    <!-- LOGOWANIE -->
    <div id="loginView" class="container hidden">
      <img src="https://i.imgur.com/tTBcBSj.jpeg" class="logo" style="width:200px;margin-bottom:20px;">
      <h1>Logowanie</h1>
      <div style="opacity:.8; margin-bottom:10px;">
        Club: <b id="clubIdBadge"></b>
      </div>
      <div class="login-box">
        <input id="numer" type="text" placeholder="Numer / Inicja≈Çy">
        <input id="haslo" type="password" placeholder="Has≈Ço">
        <button class="full-btn" onclick="zaloguj()">Zaloguj</button>
        <button class="full-btn alt" onclick="pokazRejestracjaSelect()">Rejestracja</button>
        <button class="full-btn alt" onclick="pokazClubSetup(true)">‚öô Zmie≈Ñ klub</button>
      </div>
      <p id="komunikat"></p>
    </div>

    <!-- WYB√ìR TYP REJESTRACJI -->
    <div id="registerSelectView" class="container hidden">
      <h1>Rejestracja</h1>
      <button class="full-btn" onclick="pokazRejestracjaZawodnik()">Zawodnik</button>
      <button class="full-btn" onclick="pokazRejestracjaTrener()">Trener</button>
      <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- REJESTRACJA ZAWODNIKA -->
    <div id="registerZawodnikView" class="container hidden">
      <h1>Rejestracja zawodnika</h1>
      <div class="login-box">
        <input id="regNumer" type="number" placeholder="Numer zawodnika">
        <input id="regNazwisko" type="text" placeholder="Imiƒô i nazwisko">
        <input id="regHaslo" type="password" placeholder="Ustaw has≈Ço">
        <button class="full-btn" onclick="wyslijRejestracje()">Zarejestruj</button>
      </div>
      <p id="regMsg"></p>
      <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- REJESTRACJA TRENERA -->
    <div id="rejestracjaTrenerView" class="container hidden">
      <h1>Rejestracja trenera</h1>
      <div class="login-box">
        <input id="regNazwiskoTrener" type="text" placeholder="Imiƒô i nazwisko">
        <input id="regHasloTrener" type="password" placeholder="Ustaw has≈Ço">
        <button class="full-btn" onclick="wyslijRejestracjeTrener()">Zarejestruj</button>
        <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>
      </div>
      <p id="regMsgTrener"></p>
    </div>

    <!-- DODAJ WYDARZENIE (TRENER) -->
    <div id="trainerDodajWydarzenieView" class="container hidden">
      <h1>Dodaj wydarzenie</h1>

      <div class="login-box">
        <input id="eventData" type="date">
        <input id="eventStart" type="time">
        <input id="eventEnd" type="time">
        <input id="eventRodzaj" type="text" placeholder="Rodzaj wydarzenia">

        <select id="eventTrener1" class="select-like-input">
          <option value="">‚Äî wybierz trenera ‚Äî</option>
        </select>

        <select id="eventTrener2" class="select-like-input">
          <option value="">‚Äî brak ‚Äî</option>
        </select>
      </div>

      <!-- CHECKBOXY GRUP -->
      <div style="display:flex; justify-content:center; gap:25px; margin:20px auto 10px auto; width:260px;">
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G1"><span>G1</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G2"><span>G2</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G3"><span>G3</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G4"><span>G4</span></label>
        <label class="grupa-check"><input type="checkbox" class="eventGrupa" value="G5"><span>G5</span></label>
      </div>

      <div style="margin-top:10px;">
        <label>
          <input id="eventStat" type="checkbox">
          Liczyƒá do statystyk
        </label>
      </div>

      <button class="full-btn" onclick="wyslijNoweWydarzenie()">üíæ Dodaj wydarzenie</button>
      <button class="full-btn alt" onclick="appBack()">‚¨Ö Powr√≥t</button>

      <p id="eventMsg" style="margin-top:10px;"></p>
    </div>

    <!-- P≈ÅATNO≈öCI -->
    <div id="platnosciView" class="container hidden">
      <h1>P≈Çatno≈õci</h1>
      <div id="listaPlatnosci">≈Åadowanie...</div>
    </div>

    <!-- WYDARZENIA (ZAWODNIK) -->
    <div id="homeView" class="container hidden">
      <h1 id="tytulTreningow">TWOJE WYDARZENIA</h1>
      <div id="listaTreningow">≈Åadowanie...</div>
      <button onclick="pokazStatystyki()" style="margin-top:20px;">üìà Poka≈º statystyki</button>
      <button onclick="powrotDoPlatnosci()" style="margin-top:10px;background:#333;">‚¨Ö Powr√≥t do p≈Çatno≈õci</button>
    </div>

    <!-- STATYSTYKI -->
    <div id="statsView" class="container hidden">
      <h1>Moje statystyki</h1>
      <div id="listaStatystyk">≈Åadowanie...</div>
      <button onclick="powrotDoTreningow()" style="margin-top:20px;">‚¨Ö Powr√≥t</button>
    </div>

    <!-- PANEL TRENERA -->
    <div id="trainerPanelView" class="container hidden">
      <h1>Panel trenera</h1>
      <button class="full-btn" onclick="trainerPokazZawodnicy()">üë• Zawodnicy</button>
      <button class="full-btn" onclick="trainerPokazWydarzenia()">üèí Wydarzenia</button>
      <button class="full-btn alt" onclick="pokazLogowanie()">‚¨Ö Wyloguj</button>
    </div>

    <!-- LISTA ZAWODNIK√ìW (TRENER) -->
    <div id="trainerZawodnicyView" class="container hidden">
      <h1>Lista zawodnik√≥w</h1>
      <div id="trainerListaZawodnikow">≈Åadowanie...</div>
      <button class="full-btn alt" onclick="trainerPowrot()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- WYDARZENIA (TRENER) -->
    <div id="trainerWydarzeniaView" class="container hidden">
      <h1>Wydarzenia</h1>
      <div id="trainerListaWydarzen">≈Åadowanie...</div>
      <button class="full-btn" style="margin-top:20px;" onclick="pokazDodajWydarzenie()">‚ûï Dodaj wydarzenie</button>
      <button class="full-btn alt" onclick="trainerPowrot()">‚¨Ö Powr√≥t</button>
    </div>

    <!-- Popup potwierdzenia usuniƒôcia -->
    <div id="trainerDeletePopup">
      <div class="popup-card">
        <p style="margin-bottom:15px;">Czy napewno chcesz usunƒÖƒá wydarzenie ?</p>
        <button class="full-btn" onclick="trainerConfirmDeleteYes()">TAK</button>
        <button class="full-btn alt" style="margin-top:8px;" onclick="trainerHideDeletePopup()">Anuluj</button>
      </div>
    </div>
  </div><!-- /app -->

  <!-- BUSY OVERLAY -->
<div id="busyOverlay" class="hidden" style="
  position:fixed; inset:0; background:rgba(0,0,0,0.75);
  display:flex; align-items:center; justify-content:center;
  z-index:5000;">
  <div class="card" style="max-width:280px;text-align:center;">
    <div style="font-size:18px;margin-bottom:8px;">‚è≥ Przygotowujƒô aplikacjƒô‚Ä¶</div>
    <div id="busyText" style="opacity:0.85;font-size:13px;">Tworzƒô pliki i ustawienia klubu.</div>
  </div>
</div>

  <script>
    /* =================== START / INTRO =================== */
    function odtworzIntroSound() {
      try {
        const audio = new Audio("sound.mp3");
        audio.volume = 0.7;
        audio.play().catch(e => console.warn("Nie mo≈ºna odtworzyƒá d≈∫wiƒôku:", e));
      } catch (err) {
        console.error("B≈ÇƒÖd d≈∫wiƒôku:", err);
      }
    }

    /* =================== KONFIG / GLOBALNE =================== */

    // ‚úÖ TU WSTAW SW√ìJ NOWY CORE (WebApp /exec)
    const CORE_URL = "https://script.google.com/macros/s/AKfycbwn7Zb9uotc34HNLAsr79r5G5ctr2G2PzIxmZZFyQfeDD2Q8vecZCArQ-ezKVB5TcOexw/exec";

    window.onerror = function (msg, src, line, col, err) {
  try {
    document.body.innerHTML = `
      <div style="padding:16px;color:#fff;background:#000;font-family:sans-serif;">
        <h2>‚ùå B≈ÇƒÖd w index.html</h2>
        <div style="opacity:.8;margin-top:8px;">${msg}</div>
        <div style="opacity:.6;margin-top:8px;font-size:12px;">${src || ""}:${line || ""}:${col || ""}</div>
        <pre style="white-space:pre-wrap;opacity:.75;margin-top:12px;">${(err && err.stack) ? err.stack : ""}</pre>
      </div>`;
  } catch {}
};


    /* =================== ORGHUB ‚Äì KONFIG LOKALNA =================== */

const LS_KEY = "orghub.clubConfig.v1";

function loadLocalClubConfig() {
  try { return JSON.parse(localStorage.getItem(LS_KEY) || "null"); }
  catch { return null; }
}

function saveLocalClubConfig(cfg) {
  localStorage.setItem(LS_KEY, JSON.stringify(cfg));
}

function clearLocalClubConfig() {
  localStorage.removeItem(LS_KEY);
}

function showBusy(text) {
  const ov = document.getElementById("busyOverlay");
  const bt = document.getElementById("busyText");
  if (bt && text) bt.textContent = text;
  ov.classList.remove("hidden");
}

function hideBusy() {
  document.getElementById("busyOverlay").classList.add("hidden");
}


    /* =================== ORGHUB WIZARD =================== */

let wiz = {
  logoBase64: "",
  clubName: "",
  seasonStartMY: "", // "MM-YYYY"
  seasonEndMY: "",
  bgColor: "",
  email: ""
};

function showBusy(msg) {
  const ov = document.getElementById("busyOverlay");
  const m = document.getElementById("busyOverlayMsg");
  if (m) m.textContent = msg || "Przygotowujƒô aplikacjƒô‚Ä¶";
  if (ov) ov.classList.remove("hidden");
}
function hideBusy() {
  const ov = document.getElementById("busyOverlay");
  if (ov) ov.classList.add("hidden");
}
function setWizMsg(t) {
  const el = document.getElementById("wizMsg");
  if (el) el.textContent = t || "";
}

function wizPickLogo() {
  document.getElementById("wizLogoFile").click();
}

document.addEventListener("change", (e) => {
  const el = e.target;
  if (!el || el.id !== "wizLogoFile") return;
  const file = el.files && el.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    wiz.logoBase64 = String(reader.result || "");
    const prev = document.getElementById("wizLogoPreview");
    if (prev) prev.innerHTML = `<img src="${wiz.logoBase64}" style="width:180px;border-radius:16px;border:1px solid #444;">`;
  };
  reader.readAsDataURL(file);
});

function wizPromptText(key, title) {
  const val = prompt(title, wiz[key] || "");
  if (val === null) return;
  wiz[key] = String(val).trim();

  if (key === "wizClubName") {
    document.getElementById("wizClubNameLabel").textContent = wiz[key] || "‚Äî";
    wiz.clubName = wiz[key];
  }
  if (key === "wizEmail") {
    document.getElementById("wizEmailLabel").textContent = wiz[key] || "‚Äî";
    wiz.email = wiz[key];
  }
}

function wizPromptMonthYear(storeKey, title) {
  // storeKey: "wizSeasonStart" / "wizSeasonEnd" tylko jako identyfikator, warto≈õci trzymamy w wiz.seasonStartMY / seasonEndMY
  const current = storeKey === "wizSeasonStart" ? wiz.seasonStartMY : wiz.seasonEndMY;
  const raw = prompt(title, current || "09-2026");
  if (raw === null) return;
  const s = String(raw).trim();

  if (!/^\d{2}-\d{4}$/.test(s)) {
    alert("Wpisz w formacie MM-RRRR, np. 09-2026");
    return;
  }
  const mm = parseInt(s.slice(0,2),10);
  const yyyy = parseInt(s.slice(3),10);
  if (mm < 1 || mm > 12 || yyyy < 2000 || yyyy > 2100) {
    alert("Podaj poprawny miesiƒÖc i rok.");
    return;
  }

  if (storeKey === "wizSeasonStart") {
    wiz.seasonStartMY = s;
    document.getElementById("wizSeasonStartLabel").textContent = s;
  } else {
    wiz.seasonEndMY = s;
    document.getElementById("wizSeasonEndLabel").textContent = s;
  }
}

function wizPickColor() {
  // proste 4x4 ‚Äì bez biblioteki
  const palette = [
    "#000000","#111111","#1b1b1b","#2a2a2a",
    "#0b1b2b","#0b2b1b","#2b0b1b","#2b1b0b",
    "#1a0b2b","#0b2b2b","#2b2b0b","#2b0b2b",
    "#202a44","#2a4420","#44202a","#444444"
  ];

  // szybkie okno wyboru: prompt z numerem
  const idx = prompt(
    "Wybierz kolor t≈Ça (podaj numer 1-16):\n" +
    palette.map((c,i)=>`${i+1}. ${c}`).join("\n"),
    "1"
  );
  if (idx === null) return;
  const n = parseInt(idx,10);
  if (!n || n < 1 || n > 16) { alert("Podaj numer 1-16"); return; }

  wiz.bgColor = palette[n-1];
  document.getElementById("wizColorSwatch").style.background = wiz.bgColor;
  document.getElementById("wizColorText").textContent = wiz.bgColor;
}

function monthYearToDates_(mmYYYY, isStart) {
  const mm = parseInt(mmYYYY.slice(0,2),10);
  const yyyy = parseInt(mmYYYY.slice(3),10);
  if (isStart) {
    // pierwszy dzie≈Ñ miesiƒÖca
    return `${yyyy}-${String(mm).padStart(2,"0")}-01`;
  }
  // ostatni dzie≈Ñ miesiƒÖca
  const lastDay = new Date(yyyy, mm, 0).getDate(); // mm=1..12 ‚Üí w JS monthIndex=mm, day 0 = ostatni dzie≈Ñ poprzedniego miesiƒÖca => dzia≈Ça
  return `${yyyy}-${String(mm).padStart(2,"0")}-${String(lastDay).padStart(2,"0")}`;
}

function validateWizard_() {
  if (!wiz.logoBase64) return "Wgraj logo.";
  if (!wiz.clubName) return "Podaj nazwƒô klubu.";
  if (!wiz.seasonStartMY) return "Podaj poczƒÖtek sezonu (MM-RRRR).";
  if (!wiz.seasonEndMY) return "Podaj koniec sezonu (MM-RRRR).";
  if (!wiz.bgColor) return "Wybierz kolor t≈Ça.";
  if (!wiz.email) return "Podaj email.";

  const start = monthYearToDates_(wiz.seasonStartMY, true);
  const end = monthYearToDates_(wiz.seasonEndMY, false);
  if (start > end) return "PoczƒÖtek sezonu nie mo≈ºe byƒá po ko≈Ñcu sezonu.";

  return "";
}

async function wizSubmit() {
  const err = validateWizard_();
  if (err) { setWizMsg("‚ùå " + err); return; }

  const sezonStart = monthYearToDates_(wiz.seasonStartMY, true);
  const sezonEnd = monthYearToDates_(wiz.seasonEndMY, false);

  setWizMsg("‚è≥ Wysy≈Çam‚Ä¶");
  showBusy("Tworzƒô pliki klubu i konfiguracjƒô sezonu‚Ä¶");

  try {
    // To jest klucz: CORE tworzy klub (folder + 3 pliki + wpis do CONFIG)
    // i zwraca clubId + theme (logoUrl, bgColor) + ssidy
    const r = await apiPost({
      action: "createClub",
      clubName: wiz.clubName,
      sezonStart,
      sezonEnd,
      bgColor: wiz.bgColor,
      ownerEmail: wiz.email,
      logoBase64: wiz.logoBase64
    });

    if (!r || (r.success !== true && r.ok !== true)) {
      hideBusy();
      setWizMsg("‚ùå " + (r?.error || r?.message || JSON.stringify(r)));
      return;
    }

    // CORE zwraca: clubId + logoUrl + bgColor (albo theme)
    const newClubId = r.clubId;
    if (!newClubId) {
      hideBusy();
      setWizMsg("‚ùå CORE nie zwr√≥ci≈Ç clubId.");
      return;
    }

    // zapisz lokalnie i ustaw globalnie
    clubId = newClubId;
    localStorage.setItem("orghub_clubId", clubId);

    const theme = {
      bgColor: r.bgColor || wiz.bgColor,
      logoUrl: r.logoUrl || "",
      clubName: r.clubName || wiz.clubName
    };
    localStorage.setItem("orghub_theme", JSON.stringify(theme));

    applyTheme_(theme);

    hideBusy();
    setWizMsg("‚úÖ Gotowe. Przechodzƒô do logowania‚Ä¶");

    // przej≈õcie do logowania (Twoja istniejƒÖca logika)
    setTimeout(() => {
      goToView("loginView", { replace:true });
    }, 400);

  } catch (e) {
    hideBusy();
    setWizMsg("‚ùå B≈ÇƒÖd po≈ÇƒÖczenia: " + (e?.message || e));
  }
}

function applyTheme_(theme) {
  try {
    if (theme?.bgColor) document.body.style.backgroundColor = theme.bgColor;
    // podmie≈Ñ logo na loginView
    const logoImg = document.querySelector("#loginView img.logo") || document.querySelector("#loginView img");
    if (logoImg && theme?.logoUrl) logoImg.src = theme.logoUrl;
    // tytu≈Ç klubu w loginView (je≈õli chcesz dodaƒá)
  } catch {}
}

/* =================== START ROUTER =================== */
function bootstrapOrgHub_() {
  // je≈ºeli mamy zapisany clubId ‚Üí normalny start
  const saved = localStorage.getItem("orghub_clubId");
  const t = localStorage.getItem("orghub_theme");
  if (t) {
    try { applyTheme_(JSON.parse(t)); } catch {}
  }

  if (!saved) {
    goToView("orgHubStartView", { replace:true });
    return;
  }

  clubId = saved;
  goToView("loginView", { replace:true });
}


    let clubId = localStorage.getItem("clubId") || "";
    let numerZalogowanego = null;
    let grupaZalogowanego = null;
    window.grupyTrenera = "";
    let currentView = "loginView";

    function refreshClubBadge_() {
      const el = document.getElementById("clubIdBadge");
      if (el) el.textContent = clubId || "‚Äî";
    }

    function requireClubId() {
      if (!clubId) throw new Error("Brak clubId. Ustaw clubId w 'Wyb√≥r klubu'.");
    }

    async function apiGet(action, params = {}) {
      requireClubId();
      const url = new URL(CORE_URL);
      url.searchParams.set("action", action);
      url.searchParams.set("clubId", clubId);
      Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v ?? ""));
      const res = await fetch(url.toString(), { cache: "no-store" });
      return res.json();
    }

    async function apiPost(payload = {}) {
      requireClubId();
      const body = new URLSearchParams({ clubId, ...payload });
      const res = await fetch(CORE_URL, { method: "POST", body });
      return res.json();
    }

    function ukryjWszystkie() {
      document.querySelectorAll(".container").forEach(v => v.classList.add("hidden"));
    }

    function goToView(viewId, options = {}) {
      const { replace = false } = options;
      ukryjWszystkie();
      const el = document.getElementById(viewId);
      if (el) el.classList.remove("hidden");
      currentView = viewId;
      const state = { view: viewId };

      try {
        if (replace) history.replaceState(state, "", "");
        else history.pushState(state, "", "");
      } catch (e) {
        console.warn("History API error:", e);
      }
    }

    function showViewFromHistory(viewId) {
      ukryjWszystkie();
      const el = document.getElementById(viewId);
      if (el) el.classList.remove("hidden");
      currentView = viewId;
    }

    function appBack() {
      history.back();
    }

    window.addEventListener("popstate", (event) => {
      const state = event.state;
      if (state && state.view) showViewFromHistory(state.view);
      else showViewFromHistory(clubId ? "loginView" : "orgHubLandingView");
    });

    window.addEventListener('load', () => {
      odtworzIntroSound();
      setTimeout(() => {
        document.getElementById('splash').style.display = 'none';
        document.getElementById('app').classList.remove('hidden');
        document.getElementById("wersjaNum").textContent = WERSJA_APKI;

        try {
          history.replaceState({ view: clubId ? "loginView" : "orgHubLandingView" }, "", "");
        } catch (e) {}

        refreshClubBadge_();
        showViewFromHistory(clubId ? "loginView" : "orgHubLandingView");
      }, 5000);
    });

    function initStartView_() {
  const cfg = loadLocalClubConfig();

  // Je≈õli nie ma configu ‚Üí landing ORGHUB
  if (!cfg || !cfg.clubId) {
    goToView("orgHubLandingView", { replace: true });
    return;
  }

  // Je≈õli config jest ‚Üí ustaw branding i id≈∫ do logowania
  applyBranding_(cfg);
  goToView("loginView", { replace: true });
}

function applyBranding_(cfg) {
  // t≈Ço
  if (cfg.bgColor) document.body.style.backgroundColor = cfg.bgColor;

  // logo na logowaniu (podmie≈Ñ img na loginie)
  const logoImg = document.querySelector("#loginView img.logo");
  if (logoImg && cfg.logoDataUrl) logoImg.src = cfg.logoDataUrl;
}


    /* =================== WYB√ìR KLUBU =================== */
    function pokazClubSetup(replace = false) {
      goToView("clubSetupView", { replace });
      const input = document.getElementById("clubIdInput");
      if (input) input.value = clubId || "";
      const msg = document.getElementById("clubSetupMsg");
      if (msg) msg.innerText = "";
    }

    function wyczyscClubId() {
      clubId = "";
      localStorage.removeItem("clubId");
      const input = document.getElementById("clubIdInput");
      if (input) input.value = "";
      const msg = document.getElementById("clubSetupMsg");
      if (msg) msg.innerText = "";
      refreshClubBadge_();
    }

    async function zapiszClubId() {
      const msg = document.getElementById("clubSetupMsg");
      const val = (document.getElementById("clubIdInput").value || "").trim();
      if (!val) { msg.innerText = "Wpisz clubId."; return; }

      clubId = val;
      localStorage.setItem("clubId", clubId);
      refreshClubBadge_();
      msg.innerText = "‚úÖ Zapisano. Przechodzƒô do logowania‚Ä¶";
      setTimeout(() => goToView("loginView", { replace:true }), 250);
    }

    /* =================== NAWIGACJA WIDOKAMI =================== */
    function pokazLogowanie() {
      numerZalogowanego = null;
      grupaZalogowanego = null;
      window.grupyTrenera = "";
      if (!clubId) { pokazClubSetup(true); return; }
      refreshClubBadge_();
      goToView("loginView");
    }

    function pokazRejestracjaSelect() { goToView("registerSelectView"); }
    function pokazRejestracjaZawodnik() { goToView("registerZawodnikView"); }
    function pokazRejestracjaTrener() { goToView("rejestracjaTrenerView"); }

    function goToLanding() {
  goToView("orgHubLandingView");
}

function goToConfig() {
  goToView("clubConfigView");
}

function submitClubConfig() {
  const clubName = document.getElementById("cfgClubName").value.trim();
  const sezonStart = document.getElementById("cfgSeasonStart").value.trim();
  const sezonEnd = document.getElementById("cfgSeasonEnd").value.trim();
  const email = document.getElementById("cfgEmail").value.trim();
  const msg = document.getElementById("cfgMsg");

  if (!clubName) return msg.innerText = "‚ùå Podaj nazwƒô klubu.";
  if (!/^\d{4}-\d{2}$/.test(sezonStart)) return msg.innerText = "‚ùå PoczƒÖtek sezonu ma byƒá RRRR-MM, np. 2026-09";
  if (!/^\d{4}-\d{2}$/.test(sezonEnd)) return msg.innerText = "‚ùå Koniec sezonu ma byƒá RRRR-MM, np. 2027-04";
  if (!email) return msg.innerText = "‚ùå Podaj email admina.";

  msg.innerText = `‚úÖ Zapisane lokalnie (na razie tylko test UI): ${clubName}, ${sezonStart} ‚Üí ${sezonEnd}, ${email}`;
}


    /* =================== LOGOWANIE =================== */
    async function zaloguj() {
      const login = document.getElementById("numer").value.trim();
      const haslo = document.getElementById("haslo").value.trim();
      const komunikat = document.getElementById("komunikat");

      if (!clubId) { komunikat.innerText = "Ustaw clubId najpierw."; pokazClubSetup(); return; }
      if (!login || !haslo) { komunikat.innerText = "Podaj login i has≈Ço."; return; }

      komunikat.innerText = "Trwa logowanie...";

      try {
        const data = await apiPost({ mode: "login", numer: login, haslo });

        if (!data.success) {
          komunikat.innerText = "‚ùå " + (data.message || "B≈ÇƒÖd logowania");
          return;
        }

        komunikat.innerText = "‚úÖ Zalogowano";

        if (data.role === "zawodnik") {
          numerZalogowanego = data.login;
          grupaZalogowanego = data.grupa || "";

          const platnosci = await apiGet("platnosci", { numer: numerZalogowanego });

          if (Array.isArray(platnosci) && platnosci.length > 0) {
            goToView("platnosciView");
            renderPlatnosci(platnosci);
            return;
          }

          await pokazTreningi();
          return;
        }

        if (data.role === "trener") {
          window.grupyTrenera = data.grupa || "";
          goToView("trainerPanelView");
          return;
        }

      } catch (e) {
        komunikat.innerText = "B≈ÇƒÖd po≈ÇƒÖczenia: " + (e?.message || e);
      }
    }

    /* =================== PANEL TRENERA =================== */
    function trainerPowrot() { appBack(); }

    async function trainerPokazZawodnicy() {
      goToView("trainerZawodnicyView");
      const box = document.getElementById("trainerListaZawodnikow");
      box.innerHTML = "<div class='card' style='background:#222;'>‚è≥ ≈Åadowanie...</div>";

      try {
        const lista = await apiGet("statystykiSum", {});
        if (!Array.isArray(lista) || lista.length === 0) {
          box.innerHTML = "<div class='card' style='background:#111;'>Brak danych</div>";
          return;
        }

        box.innerHTML = lista.map(z => `
          <div class="card" style="text-align:left;">
            <b>#${z.nr}</b> ‚Äî ${z.nazwisko}<br>
            <span style="opacity:0.8;">${z.suma} trening√≥w ≈ÇƒÖcznie</span>
          </div>
        `).join('');

      } catch (err) {
        box.innerHTML = "<div class='card' style='background:#700;'>B≈ÇƒÖd pobierania danych</div>";
      }
    }

    async function trainerPokazWydarzenia() {
      goToView("trainerWydarzeniaView");
      const lista = await apiGet("treningiTrener", { grupa: window.grupyTrenera || "" });
      renderTreningiTrainer(lista);
    }

    function renderTreningiTrainer(lista) {
      const div = document.getElementById("trainerListaWydarzen");
      if (!lista?.length) {
        div.innerHTML = "<p>Brak wydarze≈Ñ</p>";
        return;
      }

      div.innerHTML = lista.map(t => `
        <div class="card" data-event-id="${t.miesiac}-${t.czasCol}">
          <b>${t.rodzaj}</b> &nbsp;&nbsp; ${t.data} (${t.dzien})<br>
          Godzina: <b>${t.godzStart}</b> &nbsp;&nbsp;‚Äì&nbsp;&nbsp; <b>${t.godzKoniec}</b><br>
          Trener: <b>${t.trener}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Zapisanych: ${t.zapisanych}<br><br>

          <button class="btn" onclick="trainerToggleZapisani('${t.id}')">üë• Zapisani</button>
          <button class="btn danger" onclick="trainerShowDeletePopup('${t.miesiac}', ${t.czasCol})">üóëÔ∏è Usu≈Ñ</button>
          <div id="trainer-zapisani-${t.id}" class="hidden"></div>
        </div>
      `).join('');
    }

    async function trainerToggleZapisani(id) {
      const box = document.getElementById(`trainer-zapisani-${id}`);
      if (!box) return;

      if (!box.classList.contains('hidden')) {
        box.classList.add('hidden');
        return;
      }

      box.classList.remove('hidden');
      box.innerHTML = '<div class="card" style="background:#222;">‚è≥ ≈Åadowanie...</div>';

      try {
        const lista = await apiGet("zapisani", { treningId: id });

        if (!Array.isArray(lista) || !lista.length) {
          box.innerHTML = '<div class="card" style="background:#111;">Brak zapisanych</div>';
          return;
        }

        box.innerHTML = `<div class="card" style="background:#111;">
          <b>Lista zapisanych:</b>
          <ul style="margin:6px 0 0 20px; padding:0; list-style-type:none;">
            ${lista.map(p => `<li>${p.nazwisko}</li>`).join('')}
          </ul>
        </div>`;
      } catch {
        box.innerHTML = '<div class="card" style="background:#700;">B≈ÇƒÖd pobierania listy</div>';
      }
    }

    /* =================== DODAWANIE WYDARZENIA (TRENER) =================== */
    async function zaladujListeTrenerow() {
      try {
        const lista = await apiGet("getTrenerzy", {});
        const t1 = document.getElementById("eventTrener1");
        const t2 = document.getElementById("eventTrener2");

        t1.innerHTML = "<option value=''>‚Äî wybierz trenera ‚Äî</option>";
        t2.innerHTML = "<option value=''>‚Äî Brak ‚Äî</option>";

        (lista || []).forEach(nazw => {
          t1.innerHTML += `<option value="${nazw}">${nazw}</option>`;
          t2.innerHTML += `<option value="${nazw}">${nazw}</option>`;
        });
      } catch (err) {
        console.error("B≈ÇƒÖd pobierania trener√≥w:", err);
      }
    }

    function pokazDodajWydarzenie() {
      goToView("trainerDodajWydarzenieView");
      zaladujListeTrenerow();
    }

    function validHour(hhmm) { return /^\d{2}:\d{2}$/.test(hhmm); }

    async function wyslijNoweWydarzenie() {
      const data = document.getElementById("eventData").value;
      const start = document.getElementById("eventStart").value;
      const end = document.getElementById("eventEnd").value;
      const rodzaj = document.getElementById("eventRodzaj").value;
      const trener1 = document.getElementById("eventTrener1").value;
      const trener2 = document.getElementById("eventTrener2").value;

      const grupy = [...document.querySelectorAll(".eventGrupa:checked")]
        .map(c => c.value)
        .join(",");

      const liczDoStat = document.getElementById("eventStat").checked;
      const msg = document.getElementById("eventMsg");

      if (!data || !start || !rodzaj) { msg.innerText = "Uzupe≈Çnij: Data, Godzina, Rodzaj."; return; }
      if (!validHour(start) || !validHour(end)) { msg.innerText = "‚ùå Godzina w formacie HH:MM."; return; }
      if (start >= end) { msg.innerText = "‚ùå Koniec musi byƒá p√≥≈∫niej ni≈º start."; return; }

      msg.innerText = "‚è≥ Dodawanie wydarzenia...";

      try {
        const r = await apiPost({
          action: "dodajWydarzenie",
          data,
          godzStart: start,
          godzKoniec: end,
          rodzaj,
          trener1,
          trener2,
          grupy,
          liczDoStatystyk: String(liczDoStat)
        });

        msg.innerText = r.message || "Nieznany wynik.";

        if (r.success) {
          document.querySelectorAll("#trainerDodajWydarzenieView input").forEach(i => {
            if (i.type !== "checkbox") i.value = "";
            else i.checked = false;
          });
          setTimeout(() => trainerPokazWydarzenia(), 800);
        }
      } catch (err) {
        msg.innerText = "‚ùå B≈ÇƒÖd po≈ÇƒÖczenia: " + err;
      }
    }

    /* =================== P≈ÅATNO≈öCI =================== */
    function renderPlatnosci(lista) {
      const div = document.getElementById("listaPlatnosci");
      if (!lista?.length) {
        div.innerHTML = "<p>Brak zaleg≈Ço≈õci ‚úÖ</p>" +
          "<button class='full-btn' onclick='pokazTreningi()'>Dalej ‚û°</button>";
        return;
      }

      div.innerHTML =
        "<h3>Zaleg≈Çe p≈Çatno≈õci:</h3>" +
        lista.map(p =>
          `<div class='card' style='background:#a00;'>üî¥ ${p.nazwa} ‚Äì ${p.kwota} z≈Ç</div>`
        ).join('') +
        `<button class='full-btn' onclick='pokazTreningi()' style='margin-top:20px;'>Dalej ‚û°</button>`;
    }

    async function pokazTreningi() {
      goToView("homeView");
      const lista = await apiGet("treningi", {
        grupa: grupaZalogowanego,
        numer: numerZalogowanego
      });
      renderTreningi(lista);
    }

    /* =================== WYDARZENIA (ZAWODNIK) =================== */
    function renderTreningi(lista) {
      const div = document.getElementById('listaTreningow');
      if (!lista?.length) {
        div.innerHTML = "<p>Brak wydarze≈Ñ</p>";
        return;
      }

      div.innerHTML = lista.map(t => `
        <div class="card">
          <p>
            <b>${t.rodzaj}</b> &nbsp;&nbsp; ${t.data} (${t.dzien})<br>
            Godzina: <b>${t.godzStart}</b> &nbsp;&nbsp;‚Äì&nbsp;&nbsp; <b>${t.godzKoniec}</b><br>
            Trener: <b>${t.trener}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Zapisanych: ${t.zapisanych}
          </p>

          <div style="display:flex;justify-content:center;gap:8px;flex-wrap:wrap;">
            <button id="btn-${t.id}" ${t.zapisany ? 'disabled' : ''} onclick="zapiszSie('${t.id}')">
              ${t.zapisany ? 'Zapisano ‚úÖ' : 'Zapisz siƒô'}
            </button>
            <button id="wypisz-${t.id}" ${t.zapisany ? '' : 'disabled'} style="background:#444;" onclick="wypiszSie('${t.id}')">
              Wypisz siƒô
            </button>
            <button style="background:#333;" onclick="toggleZapisani('${t.id}')">üë• Zapisani</button>
          </div>

          <div id="zapisani-${t.id}" class="hidden lista-zapisanych"></div>
        </div>
      `).join('');
    }

    async function toggleZapisani(id) {
      const box = document.getElementById(`zapisani-${id}`);
      if (!box) return;

      if (!box.classList.contains('hidden')) {
        box.classList.add('hidden');
        return;
      }

      box.classList.remove('hidden');
      box.innerHTML = '<div class="card" style="background:#222;">‚è≥ ≈Åadowanie...</div>';

      try {
        const lista = await apiGet("zapisani", { treningId: id });

        if (!Array.isArray(lista) || lista.length === 0) {
          box.innerHTML = '<div class="card" style="background:#111;">Brak zapisanych</div>';
          return;
        }

        box.innerHTML = `<div class="card" style="background:#111;">
          <b>Lista zapisanych:</b>
          <ul style="margin:6px 0 0 20px; padding:0; list-style-type:none;">
            ${lista.map(p => `<li>${p.nazwisko}</li>`).join('')}
          </ul>
        </div>`;
      } catch {
        box.innerHTML = '<div class="card" style="background:#700;">B≈ÇƒÖd pobierania listy</div>';
      }
    }

    async function zapiszSie(id) {
      const btn = document.getElementById(`btn-${id}`);
      const wypiszBtn = document.getElementById(`wypisz-${id}`);
      const box = document.getElementById(`zapisani-${id}`);

      btn.classList.add("loading");
      try {
        const r = await apiGet("zapisz", { numer: numerZalogowanego, treningId: id });
        if (r.ok) {
          btn.innerText = "Zapisano ‚úÖ";
          btn.disabled = true;
          wypiszBtn.disabled = false;
          if (box && !box.classList.contains("hidden")) await odswiezListeZapisanych(id);
        } else {
          alert(r.message);
        }
      } catch (err) {
        alert("B≈ÇƒÖd po≈ÇƒÖczenia: " + err);
      } finally {
        btn.classList.remove("loading");
      }
    }

    async function wypiszSie(id) {
      const btn = document.getElementById(`wypisz-${id}`);
      const zapiszBtn = document.getElementById(`btn-${id}`);
      const box = document.getElementById(`zapisani-${id}`);

      btn.classList.add("loading");
      try {
        const r = await apiGet("wypisz", { numer: numerZalogowanego, treningId: id });
        if (r.ok) {
          zapiszBtn.innerText = "Zapisz siƒô";
          zapiszBtn.disabled = false;
          btn.disabled = true;
          if (box && !box.classList.contains("hidden")) await odswiezListeZapisanych(id);
        } else {
          alert(r.message);
        }
      } catch (err) {
        alert("B≈ÇƒÖd po≈ÇƒÖczenia: " + err);
      } finally {
        btn.classList.remove("loading");
      }
    }

    async function odswiezListeZapisanych(id) {
      const box = document.getElementById(`zapisani-${id}`);
      if (!box) return;

      box.innerHTML = '<div class="card" style="background:#222;">‚è≥ Od≈õwie≈ºanie...</div>';
      try {
        const lista = await apiGet("zapisani", { treningId: id });

        if (!Array.isArray(lista) || lista.length === 0) {
          box.innerHTML = '<div class="card" style="background:#111;">Brak zapisanych</div>';
          return;
        }

        box.innerHTML = `<div class="card" style="background:#111;">
          <b>Lista zapisanych:</b>
          <ul style="margin:6px 0 0 20px; padding:0; list-style-type:none;">
            ${lista.map(p => `<li>${p.nazwisko}</li>`).join('')}
          </ul>
        </div>`;
      } catch {
        box.innerHTML = '<div class="card" style="background:#700;">B≈ÇƒÖd od≈õwie≈ºania</div>';
      }
    }

    /* =================== STATYSTYKI =================== */
    async function pokazStatystyki() {
      goToView("statsView");
      const lista = await apiGet("statystyki", { numer: numerZalogowanego });
      renderStatystyki(lista);
    }

    function renderStatystyki(lista) {
      const div = document.getElementById("listaStatystyk");
      if (!lista?.length) { div.innerHTML = "<p>Brak danych</p>"; return; }

      const suma = lista.reduce((acc, s) => acc + (Number(s.treningi) || 0), 0);
      div.innerHTML =
        lista.map(s => `<div class="card">üìÖ ${s.miesiac} ‚Äî üèí ${s.treningi} trening√≥w</div>`).join('') +
        `<div class="card" style="background:#222;margin-top:20px;font-weight:bold;">
          üî• ≈ÅƒÖcznie: ${suma} trening√≥w w sezonie
        </div>`;
    }

    function powrotDoTreningow() { appBack(); }
    function powrotDoPlatnosci() { appBack(); }

    /* =================== REJESTRACJA =================== */
    async function wyslijRejestracje() {
      const numer = document.getElementById("regNumer").value.trim();
      const nazwisko = document.getElementById("regNazwisko").value.trim();
      const haslo = document.getElementById("regHaslo").value.trim();
      const msg = document.getElementById("regMsg");

      if (!numer || !nazwisko || !haslo) { msg.innerText = "Wype≈Çnij wszystkie pola."; return; }

      msg.innerText = "‚è≥ Rejestracja...";
      try {
        const data = await apiPost({ mode: "rejestracja", numer, nazwisko, haslo });

        if (data.ok) {
          document.getElementById("regNumer").value = "";
          document.getElementById("regNazwisko").value = "";
          document.getElementById("regHaslo").value = "";
          msg.innerText = "‚úÖ Rejestracja zako≈Ñczona!";
          setTimeout(() => { msg.innerText = ""; pokazLogowanie(); }, 1500);
        } else {
          msg.innerText = "‚ùå " + (data.msg || "B≈ÇƒÖd");
        }
      } catch (e) {
        msg.innerText = "B≈ÇƒÖd po≈ÇƒÖczenia.";
      }
    }

    async function wyslijRejestracjeTrener() {
      const poleNazw = document.getElementById("regNazwiskoTrener");
      const poleHaslo = document.getElementById("regHasloTrener");
      const msg = document.getElementById("regMsgTrener");

      const nazwisko = poleNazw.value.trim();
      const haslo = poleHaslo.value.trim();
      if (!nazwisko || !haslo) { msg.innerText = "Wype≈Çnij wszystkie pola."; return; }

      msg.innerText = "‚è≥ Rejestracja...";
      try {
        const data = await apiPost({ mode: "rejestracjaTrener", nazwisko, haslo });

        if (data.ok) {
          const inic = data.inic || "(?)";
          msg.innerHTML = `
            ‚úÖ <b>Zarejestrowano trenera!</b><br>
            Login do systemu: <b>${inic}</b><br><br>
            <button class="full-btn" onclick="navigator.clipboard.writeText('${inic}')">üìã Skopiuj login</button>
          `;
          poleNazw.value = "";
          poleHaslo.value = "";
          setTimeout(() => { msg.innerText = ""; pokazLogowanie(); }, 8000);
        } else {
          msg.innerText = "‚ùå " + (data.msg || "B≈ÇƒÖd");
        }
      } catch (e) {
        msg.innerText = "B≈ÇƒÖd po≈ÇƒÖczenia.";
      }
    }

    /* =================== USUWANIE WYDARZENIA =================== */
    let deleteMiesiac = null;
    let deleteCzasCol = null;

    function trainerShowDeletePopup(miesiac, czasCol) {
      deleteMiesiac = miesiac;
      deleteCzasCol = czasCol;
      document.getElementById("trainerDeletePopup").classList.add("show");
    }

    function trainerHideDeletePopup() {
      document.getElementById("trainerDeletePopup").classList.remove("show");
    }

    async function trainerConfirmDeleteYes() {
      trainerHideDeletePopup();

      const treningId = `${deleteMiesiac}-${deleteCzasCol}`;
      const eventId = treningId;
      const card = document.querySelector(`[data-event-id='${eventId}']`);

      if (card) {
        card.innerHTML = `<div class="card" style="background:#222; text-align:center;">‚è≥ Usuwam wydarzenie‚Ä¶</div>`;
      }

      if (!deleteMiesiac || !deleteCzasCol) {
        if (card) {
          card.innerHTML = `<div class="card" style="background:#522; text-align:center;">‚ùå Brak danych do usuniƒôcia.</div>`;
        }
        return;
      }

      try {
        const data = await apiGet("usunWydarzenie", { treningId });

        if (data.success) {
          if (card) {
            card.innerHTML = `<div class="card" style="background:#152; text-align:center;">üóëÔ∏è Wydarzenie zosta≈Ço usuniƒôte</div>`;
          }
          setTimeout(() => trainerPokazWydarzenia(), 800);
        } else {
          if (card) {
            card.innerHTML = `<div class="card" style="background:#522; text-align:center;">‚ùå B≈ÇƒÖd usuwania: ${data.error || "Nieznany b≈ÇƒÖd"}</div>`;
          }
        }
      } catch (err) {
        if (card) {
          card.innerHTML = `<div class="card" style="background:#522; text-align:center;">‚ùå B≈ÇƒÖd po≈ÇƒÖczenia: ${err}</div>`;
        }
      }
    }
    /* =================== ORGHUB ‚Äì KONFIG UI =================== */

let cfgDraft = {
  clubName: "",
  email: "",
  sezonStart: "", // YYYY-MM-01
  sezonEnd: "",   // YYYY-MM-30 (umownie)
  bgColor: "#000000",
  logoDataUrl: ""
};

const COLOR_PRESETS = [
  // Czarne / szaro≈õci (2 odcienie)
  "#000000", "#1a1a1a",

  // Granat (2)
  "#0b1b2b", "#123a5a",

  // Niebieski (2)
  "#0b2b5a", "#1a4fa3",

  // Turkus (2)
  "#0b2b2b", "#118a8a",

  // Ziele≈Ñ (2)
  "#0b2b1b", "#1f7a3a",

  // Oliwka (2)
  "#2b2b0b", "#7a7a1f",

  // Pomara≈Ñcz/brƒÖz (2)
  "#2b1b0b", "#a35a1a",

  // Bordo/fiolet (2)
  "#2b0b1b", "#6a1b3a"
];


function goToConfig() {
  // je≈õli istnieje zapisany config ‚Üí wczytaj do draftu (edycja)
  const saved = loadLocalClubConfig();
  if (saved) cfgDraft = { ...cfgDraft, ...saved };

  renderConfigUI_();
  goToView("clubConfigView");
}

function goBackFromConfig() {
  const saved = loadLocalClubConfig();
  if (saved && saved.clubId) goToView("loginView");
  else goToView("orgHubLandingView");
}

function renderConfigUI_() {
  const nameEl = document.getElementById("cfgClubNameLabel");
  const ssEl = document.getElementById("cfgSeasonStartLabel");
  const seEl = document.getElementById("cfgSeasonEndLabel");
  const emEl = document.getElementById("cfgEmailLabel");
  const colEl = document.getElementById("cfgColorLabel");
  const prev = document.getElementById("cfgLogoPreview");

  nameEl.textContent = cfgDraft.clubName ? `‚úÖ ${cfgDraft.clubName}` : "‚Äî nie ustawiono";
  ssEl.textContent = cfgDraft.sezonStart ? `‚úÖ ${cfgDraft.sezonStart}` : "‚Äî nie ustawiono";
  seEl.textContent = cfgDraft.sezonEnd ? `‚úÖ ${cfgDraft.sezonEnd}` : "‚Äî nie ustawiono";
  emEl.textContent = cfgDraft.email ? `‚úÖ ${cfgDraft.email}` : "‚Äî nie ustawiono";
  colEl.textContent = cfgDraft.bgColor ? `‚úÖ ${cfgDraft.bgColor}` : "‚Äî nie ustawiono";

  if (cfgDraft.logoDataUrl) {
    prev.src = cfgDraft.logoDataUrl;
    prev.style.display = "inline-block";
  } else {
    prev.style.display = "none";
  }

  // siatka kolor√≥w
  const grid = document.getElementById("cfgColorGrid");
  grid.innerHTML = COLOR_PRESETS.map(c => `
    <div onclick="setBgColor('${c}')" style="
      width:100%; aspect-ratio:1/1; border-radius:10px;
      border:1px solid #444; background:${c}; cursor:pointer;">
    </div>
  `).join("");
}

function toggleColorPicker(show) {
  const grid = document.getElementById("cfgColorGrid");
  if (show) grid.classList.remove("hidden");
  else grid.classList.add("hidden");
}

function setBgColor(color) {
  cfgDraft.bgColor = color;
  document.body.style.backgroundColor = color;
  document.getElementById("cfgColorLabel").textContent = `‚úÖ ${color}`;
}

function pickLogo() {
  const input = document.getElementById("cfgLogoInput");
  input.onchange = async () => {
    const file = input.files && input.files[0];
    if (!file) return;

    // szybka walidacja
    if (file.size > 2 * 1024 * 1024) {
      document.getElementById("cfgMsg").textContent = "‚ùå Logo za du≈ºe (max ~2MB).";
      return;
    }

    const dataUrl = await fileToDataUrl_(file);
    cfgDraft.logoDataUrl = dataUrl;
    renderConfigUI_();
  };
  input.click();
}

function fileToDataUrl_(file) {
  return new Promise((resolve, reject) => {
    const r = new FileReader();
    r.onload = () => resolve(String(r.result || ""));
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}

function editClubName() {
  const v = prompt("Podaj nazwƒô klubu:", cfgDraft.clubName || "");
  if (v === null) return;
  cfgDraft.clubName = v.trim();
  renderConfigUI_();
}

function editEmail() {
  const v = prompt("Podaj email admina:", cfgDraft.email || "");
  if (v === null) return;
  cfgDraft.email = v.trim();
  renderConfigUI_();
}

function editSeasonStart() {
  const v = prompt("PoczƒÖtek sezonu (RRRR-MM), np. 2026-09:", cfgDraft.sezonStart ? cfgDraft.sezonStart.slice(0,7) : "");
  if (v === null) return;
  const m = String(v).trim();
  if (!/^\d{4}-\d{2}$/.test(m)) {
    document.getElementById("cfgMsg").textContent = "‚ùå Z≈Çy format. U≈ºyj RRRR-MM.";
    return;
  }
  cfgDraft.sezonStart = `${m}-01`;
  renderConfigUI_();
}

function editSeasonEnd() {
  const v = prompt("Koniec sezonu (RRRR-MM), np. 2027-04:", cfgDraft.sezonEnd ? cfgDraft.sezonEnd.slice(0,7) : "");
  if (v === null) return;
  const m = String(v).trim();
  if (!/^\d{4}-\d{2}$/.test(m)) {
    document.getElementById("cfgMsg").textContent = "‚ùå Z≈Çy format. U≈ºyj RRRR-MM.";
    return;
  }
  // Umownie ko≈Ñczymy na -30 (backend mo≈ºe to skorygowaƒá)
  cfgDraft.sezonEnd = `${m}-30`;
  renderConfigUI_();
}

 // --- inline edit: Nazwa klubu ---
let cfg = window.cfg || { clubName:"", sezonStart:"", sezonEnd:"", email:"", color:"#000000", logoDataUrl:"" };
window.cfg = cfg;

function clubNameEditStart() {
  const span = document.getElementById("clubNameText");
  const inp  = document.getElementById("clubNameInput");
  if (!span || !inp) return;

  // poka≈º input w przycisku
  span.classList.add("hidden");
  inp.classList.remove("hidden");
  inp.value = cfg.clubName || "";
  inp.focus();
  inp.select();

  inp.onkeydown = (e) => {
    if (e.key === "Enter") clubNameEditCommit();
    if (e.key === "Escape") clubNameEditCancel();
  };
  inp.onblur = () => clubNameEditCommit();
}

function clubNameEditCommit() {
  const span = document.getElementById("clubNameText");
  const inp  = document.getElementById("clubNameInput");
  if (!span || !inp) return;

  const val = (inp.value || "").trim();
  cfg.clubName = val;

  // przywr√≥ƒá przycisk
  inp.classList.add("hidden");
  span.classList.remove("hidden");
  span.textContent = val ? `Nazwa: ${val}` : "Podaj nazwƒô klubu";
}

function clubNameEditCancel() {
  const span = document.getElementById("clubNameText");
  const inp  = document.getElementById("clubNameInput");
  if (!span || !inp) return;

  inp.classList.add("hidden");
  span.classList.remove("hidden");
}



  </script>
</body>
</html>
</body>
</html>
